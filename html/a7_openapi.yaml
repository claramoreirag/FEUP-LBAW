openapi: 3.0.0

info:
  version: '2.0'
  title: 'LBAW GreeNews Web API'
  description: 'Web Resources Specification (A7) for GreeNews'

servers:
  # Added by API Auto Mocking Plugin
  - description: 'SwaggerHub API Auto Mocking'
    url: 'https://virtserver.swaggerhub.com/marianaramos37/a7_openapi/2.0'
  - url: 'http://lbaw-prod.fe.up.pt'
    description: 'Production server'

externalDocs:
  description: 'Find more info here.'
  url: 'http://lbaw-prod.fe.up.pt'

tags:
  - name: 'M01: Authentication and Profile'
  - name: 'M02: Posts, Feed and Search'
  - name: 'M03: Comments'
  - name: 'M04: User Administration '
  - name: 'M05: Static pages'
  - name: 'M06: Notifications'
  

paths:

# ------- Authentication and profile: -----------
# R101: Login Form [/login] 
# R102: Login Action [/login] 
# R103: Logout Action [/logout] 
# R104: Register Form [/register] 
# R105: Register Action [/register] 
# R106: View Profile [/user/{user_id}] 
# R107: Edit Profile Form [/settings] 
# R108: Edit Profile Action [/settings] 
# R109: Delete Account Action [/settings] 

# -------- Posts, Feed and Search: ----------------
# R201: Home Page Posts[/{filter}] 
# R202: View Post and Comments [/post/{post_id}] 
# R203: Add Post Form [/new_post] 
# R204: Add Post Action [/new_post] 
# R205: Edit Post Form [/post/{post_id}/edit] 
# R206: Edit Post Action [/post/{post_id}] 
# R207: Delete Post Action [/post/{post_id}]  
# R208: Report Post Action [/post/{post_id}/report] 
# R209: Search Results Page [/search/{query}] 

# --------------- Comments: ----------------------
# R301: Add Comment Action [/post/{post_id}/comment] 
# R302: Add Reply Action [/comment/{comment_id}/reply] 
# R303: Edit Comment Action [/comment/{comment_id}]  
# R304: Delete Comment Action [/comment/{comment_id}] 

# --------------- User admin: ---------------------
# R401: View All Reports [/admin/{filter}] 
# R402: View Post and Comments [/admin/post/{post_id}] 
# R403: Delete Post Action [/admin/post/{post_id}] 
# R404: Delete Comment Action [/admin/comment/{comment_id}] 
# R405: View User Management [/admin/post/{post_id}] 
# R406: Delete User Action [/admin/user/{user_id}] 

  /login:
    get:
      operationId: R101
      summary: 'R101: Login Form'
      description: 'Provide login form. Access: PUB'
      tags:
        - 'M01: Authentication and Profile'
      responses:
        '200':
          description: 'Ok. Show [UI07](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2154/-/wikis/er#ui07)'
    post:
      operationId: R102
      summary: 'R102: Login Action'
      description: 'Processes the login form submission. Access: PUB'
      tags:
        - 'M01: Authentication and Profile'
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                email:         
                  type: string
                password:  
                  type: string
              required:
                - email
                - password
 
      responses:
        '302':
          description: 'Redirect after processing the login credentials.'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: 'Successful authentication. Redirect to user profile.'
                  value: '/homepage'
                302Failure:
                  description: 'Failed authentication. Redirect to login form.'
                  value: '/login'


  /logout:
    post:
      operationId: R103
      summary: 'R103: Logout Action'
      description: 'Logout the current authenticated used. Access: USR, ADM'
      tags:
        - 'M01: Authentication and Profile'
      responses:
        '302':
          description: 'Redirect after processing logout.'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: 'Successful logout. Redirect to homepage.'
                  value: '/{filter}'
                302Error:
                  description: 'Error in logout. Redirect to homepage.'
                  value: '/{filter}'
                  

  /register:
    get:
      operationId: R104
      summary: 'R104: Register Form'
      description: 'Provide new user registration form. Access: PUB'
      tags:
        - 'M01: Authentication and Profile'
      responses:
        '200':
          description: 'Ok. Show [UI06](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2154/-/wikis/er#ui06)'
    post:
      operationId: R105
      summary: 'R105: Register Action'
      description: 'Processes the new user registration form submission. Access: PUB'
      tags:
        - 'M01: Authentication and Profile'
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                username:
                  type: string
                name:
                  type: string
                email:
                  type: string
                password:
                  type: string
                confirm_password:
                  type: string
              required:
                - username
                - email
                - name
                - password
                - confirm_password
      responses:
        '302':
          description: 'Redirect after processing the new user information.'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: 'Successful authentication. Redirect to homepage.'
                  value: '/homepage'
                302Failure:
                  description: 'Failed authentication. Redirect to login form.'
                  value: '/login'

  /user/{user_id}:
    get:
      operationId: R106
      summary: 'R106: View Own Profile'
      description: 'Page that shows the user profile and activity. Access: OWN'
      tags:
        - 'M01: Authentication and Profile'
      parameters:
        - in: path
          name: user_id #user_id
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: 'Ok. Show [UI03](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2154/-/wikis/er#ui03)'


  /settings:
    get:
      operationId: R107
      summary: 'R107: Edit Profile Form'
      description: 'Provide the user an edit profile form. Access: OWN'
      tags:
        - 'M01: Authentication and Profile'
      responses:
        '200':
          description: 'Ok. Show [UI06](http://lbaw2154-piu.lbaw-prod.fe.up.pt/pages/editProfile.php)'
    put:
      operationId: R108
      summary: 'R108: Edit Profile Action'
      description: 'This web resource edits the user information.  Access: OWN'
      tags:
        - 'M01: Authentication and Profile'
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                username:
                  type: string
                name:
                  type: string
                email:
                  type: string
                password:
                  type: string
                confirm_password:
                  type: string
                photo:
                 type: string
              required:
                - username
                - email
                - name
                - password
                - confirm_password
      responses:
        '302':
          description: 'Redirect after processing the edited user information.'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: 'Successful edit profile. Redirect to user profile.'
                  value: '/myProfilePage'
                302Failure:
                  description: 'Failed edit profile. Redirect to edit profile form.'
                  value: '/editProfile'

    delete:
      operationId: R109
      summary: 'R109: Delete Profile Action'
      description: 'This web resource allows a user to delete his account. Access: OWN'
      tags:
        - 'M01: Authentication and Profile'
      responses:
        '302':
          description: 'Redirect after processing the edited user information.'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: 'Successful delete profile. Redirect to homepage.'
                  value: '/homepage'
                302Failure:
                  description: 'Failed delete profile. Redirect to users profile.'
                  value: '/myProfilePage'

  /{filter}:
    get:
      operationId: R201
      summary: 'R201: This web resource gets posts based on a certain criteria/filter. PUB'
      description: 'This web resource get the results of a query.'
      tags: 
        - 'M02: Posts, Feed and Search'
      parameters:
        - in: path
          name: filter
          description: '[newest,trending]'
          schema:
            type: string
          required: true
      responses:
        '200':
          description: 'Ok. Show [UI01](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2154/-/wikis/er#ui01)'




  /post/{post_id}:
    get:
      operationId: R202
      summary: 'R202: This resource shows the post page and its comments. PUB'
      description: 'This resource shows the post page and its comments.'
      tags: 
        - 'M02: Posts, Feed and Search'
      parameters:
        - in: path
          name: post_id
          description: 'Post primary key of the post we want to see'
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: 'Ok. Show [UI05](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2154/-/wikis/er#ui05)'
    put:
      operationId: R206
      summary: 'R206: Edit Post Action'
      description: 'Processes the edited post submission. Access: OWN'
      tags:
        - 'M02: Posts, Feed and Search'
      parameters:
        - in: path
          name: post_id
          schema:
            type: integer
          required: true
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                title:          
                  type: string
                header:   
                  type: string
                body:         
                  type: string
                category:   
                  type: string
                source:
                  type: string
              required:
                - title
                - header
                - body
                - category
                - source
      responses:
        '302':
          description: 'Redirect after processing the post information'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: 'Successful edition of post. Redirect to post.'
                  value: '/post/{post_id}'
                302BadRequest:
                  description: 'Error. Error message is specified via an HTTP header.'
                  value: '/user/{user_id}'
                302NotFound:
                  description: 'Error. No post with the specified primary key exists.'
                  value: '/user/{user_id}'
  
    delete:
        operationId: R207
        summary: 'R207: Delete Post Action'
        description: 'This web resource allows a user to delete a post. Access: OWN'
        tags:
          - 'M02: Posts, Feed and Search'
        parameters:
          - in: path
            name: post_id
            schema:
              type: integer
            required: true
        responses:
          '302':
            description: 'Redirect after deleting post'
            headers:
              Location:
                schema:
                  type: string
                examples:
                  302Success:
                    description: 'Successful delete post. Redirect to homepage.'
                    value: '/homepage'
                  302Failure:
                    description: 'Failed delete post. Redirect to users profile.'
                    value: '/user/{user_id}'

  /post/{post_id}/edit:
     get:
      operationId: R208
      summary: 'R208: This resource shows the post edit page. OWN'
      description: 'This resource shows the post edit page.'
      tags: 
        - 'M02: Posts, Feed and Search'
      parameters:
        - in: path
          name: post_id
          description: 'Post primary key of the post we want to see'
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: 'Ok. Show [UI10](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2154/-/wikis/er#ui10)'


  /new_post:
    get:
      operationId: R203
      summary: 'R203: New post form. Acess: USR'
      description: 'Page with a form to add a new post.'
      tags: 
        - 'M02: Posts, Feed and Search'
      responses:
        '200':
          description: 'Ok. Show [UI09](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2154/-/wikis/er#ui09)'
    post:
      operationId: R204
      summary: 'R204: New Post Action Acess: USR'
      description: 'This web resource allows a user to create a new post. Access: USR'
      tags:
        - 'M02: Posts, Feed and Search'
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                  title:          
                    type: string
                  header:    
                    type: string
                  body:          
                    type: string
                  category:    
                    type: string
                  source:
                    type: string
              required:
                    - title
                    - header
                    - body
                    - category
                    - source
      responses:
        '302':
          description: 'Redirect after processing the post information'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: 'Successful publication. Redirect to user profile.'
                  value: '/users/{id}'
                302Error:
                  description: 'Failed authentication. Redirect to new post.'
                  value: '/new_post'



  /post/{post_id}/report:
    post:
      operationId: R208
      summary: 'R208: Report Post Action'
      description: 'This web resource allows a user to report a post. Access: USR'
      tags:
        - 'M02: Posts, Feed and Search'
      parameters:
        - in: path
          name: post_id
          schema:
            type: integer
          required: true
      responses:
        '302':
          description: 'Redirect after processing the report'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: 'Successful report. Redirect to homepage.'
                  value: '/homepage'
                302Error:
                  description: 'Failed report. Redirect to post.'
                  value: '/post/{post_id}'

  
  /search:
    get:
      operationId: R209
      summary: 'R209: Search News and Users'
      description: 'This web resource get the results of a query.'
      tags: 
        - 'M02: Posts, Feed and Search'
      parameters:
        - in: query
          name: query
          description: String to use for full-text search
          schema:
            type: string
          required: false
        - in: query
          name: item
          description: Tags of the news
          schema:
            type: string
          required: false
        - in: query
          name: mostUpvotes
          description: Boolean with the mostUpvoted flag value
          schema:
            type: boolean
          required: false
        - in: query
          name: newest
          description: Boolean with the newest flag value
          schema:
            type: boolean
          required: false
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                    type: object
                    properties:
                      id:
                        type: integer
                      datetime:
                        type: object
                      user_id:
                        type: integer
                      title:
                        type: string
                      header:
                        type: string
                      body:
                        type: string
                      category:
                        type: string
                      upvotes:
                        type: integer
                      downvotes:
                        type: integer
                example:
                    - id: 1
                      datetime: 
                      user_id: 5
                      title: Creating liveable cities through low-carbon freight
                      header: Freight transport and emissions are increasing rapidly and, until now, cities were not equipped to handle the associated challenges. Only about 21 percent of the Nationally Determined Contributions (NDCs) highlighting transport refers to freight transport. Nonetheless, general understanding and awareness on sustainable freight have grown exponentially in recent years.
                      body: Freight transport and emissions are increasing rapidly and, until now, cities were not equipped to handle the associated challenges. Only about 21 percent of the Nationally Determined Contributions (NDCs) highlighting transport refers to freight transport. Nonetheless, general understanding and awareness on sustainable freight have grown exponentially in recent years.
                      category: Ambient
                      upvotes: 50
                      downvotes: 40
                      type: array
                  
                 


  /post/{post_id}/comment:
    post:
      operationId: R301
      summary: 'R301: Write comment action'
      description: 'This web resource allows a user to comment on a post. Access: USR, OWN'
      tags:
      - 'M03: Comments'
      parameters:
        - in: path
          name: post_id # id do post
          schema:
            type: integer
          required: true
      requestBody:
        required: true
        content: 
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                comment:
                  type: string
              required:
                - comment
      responses: 
        '302':
          description: 'Redirect after processing the new comment.'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: 'Sucessful new comment. Redirect to post page'
                  value: '/post/{post_id}'
                302Error: 
                  description: 'Failed adding new comment. Redirect to post page'
                  value: '/post/{post_id}'
   

  /comment/{comment_id}/reply:
    put:
      operationId: R302
      summary: 'R302: Write reply to comment action'
      description: '  This web resource allows a user to reply to a comment. Access: USR, OWN'
      tags:
        - 'M03: Comments'
      parameters:
        - in: path
          name: comment_id # id do comment
          schema:
            type: integer
          required: true
      requestBody:
        required: true
        content: 
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                comment:
                  type: string
              required:
                - comment
      responses: 
        '302':
          description: 'Redirect after processing the comment reply.'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: 'Sucessful new comment. Redirect to comment.'
                  value: '/comment/{comment_id}'
                302Error: 
                  description: 'Failed adding new comment. Redirect to comment.'
                  value: '/comment/{comment_id}'

  /comment/{comment_id}:
    put:
      operationId: R303
      summary: 'R303: Edit comment action'
      description: '  This web resource allows a user to edit their comment on a post. Access: OWN'
      tags:
        - 'M03: Comments'
      parameters:
        - in: path
          name: comment_id
          schema:
            type: integer
          required: true
      requestBody:
        required: true
        content: 
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                comment:
                  type: string
              required:
                - comment
      responses: 
        '302':
          description: 'Redirect after processing the comment.'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: 'Sucessful edit comment. Redirect to comment '
                  value: '/comment/{comment_id}'
                302Error: 
                  description: 'Failed edit comment. Redirect to comment'
                  value: '/comment/{comment_id}'
  
    delete:
        operationId: R304
        summary: 'R304: Delete Comment Action'
        description: 'This web resource allows a user to delete their comment on a post. Access: OWN'
        tags:
          - 'M03: Comments'
        parameters:
          - in: path
            name: comment_id
            schema:
              type: integer
            required: true
        responses:
          '302':
            description: 'Redirect after deleting comment'
            headers:
              Location:
                schema:
                  type: string
                examples:
                  302Success:
                    description: 'Successful deletion of comment. Redirect to homepage.'
                    value: '/homepage'
                  302BadRequest:
                    description: 'Error. Error message is specified via an HTTP header.'
                    value: '/comment/{comment_id}'
                  302NotFound:
                    description: 'Error. No comment with the specified primary key exists.'
                    value: '/comment/{comment_id}'



  /admin/reports/{filter}:
    get:
      operationId: R401
      summary: 'R401: Reports Dashboard'
      description: 'Admin can access a dashboard with reported posts and comments. Access: ADMN'
      tags: 
        - 'M04: User Administration'
      parameters:
          - in: path
            name: filter
            description: '[comments,posts]'
            schema:
              type: string
            required: true
      responses: 
        '200':
          description: 'Ok. Show [UI11](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2154/-/wikis/er#ui11)' 


  /admin/reports/post/{post_id}:
    get:
      operationId: R402
      summary: 'R402: View full post as administrator'
      description: 'This resource shows the post page and its comments. Access: ADMN'
      tags: 
        - 'M04: User Administration'
      parameters:
          - in: path
            name: post_id
            description: Post primary key of the post we want to see
            schema:
              type: integer
            required: true
      responses: 
        '200':
          description: 'Ok. Show [UI13](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2154/-/wikis/er#ui13)' 
    delete:
        operationId: R403
        summary: 'R403: Delete Post Action Admin'
        description: 'This web resource allows an administrator to delete a reported post. Access: ADM'
        tags:
          - 'M04: User Administration'
        parameters:
          - in: path
            name: post_id
            schema:
              type: integer
            required: true
        responses:
          '302':
            description: 'Redirect after deleting post'
            headers:
              Location:
                schema:
                  type: string
                examples:
                  302Success:
                    description: 'Successful delete post. Redirect to adminpage.'
                    value: '/admin'
                  302Failure:
                    description: 'Failed delete post. Redirect to post.'
                    value: '/admin/reports/post/{post_id}'


  /admin/reports/comment/{comment_id}:
     delete:
        operationId: R404
        summary: 'R404: Delete Comment Action Admin'
        description: 'This web resource allows an administrator to delete a reported comment. Access: ADM'
        tags:
          - 'M04: User Administration'
        parameters:
          - in: path
            name: comment_id
            schema:
              type: integer
            required: true
        responses:
          '302':
            description: 'Redirect after deleting comment'
            headers:
              Location:
                schema:
                  type: string
                examples:
                  302Success:
                    description: 'Successful delete comment. Redirect to adminpage.'
                    value: '/admin'
                  302Failure:
                    description: 'Failed delete comment. Redirect to comment.'
                    value: '/admin/reports/comment/{comment_id}'
  
  
  
  /admin/user_manager:
   get:
      operationId: R405
      summary: 'R405: View User Manager Dashboard'
      description: 'Admin can access a dashboard with all the users. Access: ADMN'
      tags: 
        - 'M04: User Administration'
      responses: 
        '200':
          description: 'Ok. Show [UI12](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2154/-/wikis/er#ui12)' 
  
  
  /admin/user_manager/{user_id}:
    delete:
        operationId: R406
        summary: 'R406: Delete User as Admin Action'
        description: 'This web resource allows a administrator to delete a user. Access: ADM'
        tags:
          - 'M04: User Administration'
        parameters:
          - in: path
            name: user_id
            schema:
              type: integer
            required: true
        responses:
          '302':
            description: 'Redirect after deleting user'
            headers:
              Location:
                schema:
                  type: string
                examples:
                  302Success:
                    description: 'Successful deletion of user. Redirect to homepage.'
                    value: '/admin/user_manager'
                  302BadRequest:
                    description: 'Error. Error message is specified via an HTTP header.'
                    value: '/admin/user_manager/{user_id}'
                  302NotFound:
                    description: 'Error. No user with the specified primary key exists.'
                    value: '/admin/user_manager/{user_id}'